---
// @src/layouts/Layout.astro (VERSIÓN 8.0 - Footer Rediseñado)
import '../styles/global.css';
import Header from '../components/Header.astro';
import { getEntry, getCollection } from 'astro:content';
import { mdToHtml } from '../utils/markdown'; 

export interface Props {
	title: string;
	description: string;
}

const { title, description } = Astro.props;
const gaId = import.meta.env.PUBLIC_GA_ID || 'G-1-A2B3C4D5E';
const ajustes = await getEntry('ajustes', 'home');
const brand_name = ajustes?.data.brand_name ?? 'TEST';

// --- LÓGICA DE DATOS DEL FOOTER Y CTA ---
const contacto = await getEntry('informacion-de-contacto', 'general');
const c = contacto?.data ?? {};
const social = c.social_media ?? {}; // Objeto de Redes Sociales
const footerNav = await getEntry('footer_navigation', 'main');
const navColumns = footerNav?.data.columns ?? [
  { // Fallback por si el CMS está vacío
    title: "Navegación",
    links: [
      { text: "Inicio", url: "/" },
      { text: "Productos", url: "/#productos" },
      { text: "Proyectos", url: "/proyectos" },
    ]
  }
];
// Datos de contacto (WA, Email, etc.)
const waNumber = c.whatsapp ?? '';
const waMsg = encodeURIComponent(c.whatsapp_message ?? 'Hola, quiero cotizar un proyecto');
const waHref = waNumber ? `https://wa.me/${waNumber}?text=${waMsg}` : null;
const email = c.email;
const phone = c.phone;
const renderedAddressHtml = mdToHtml(c.address ?? "");
const logo_footer = c.logo_footer;
const footerDescription = c.footer_description; // Campo de V6.4

// --- DATOS PARA EL BLOQUE CTA INTEGRADO ---
const contactHeadingHtml = mdToHtml(c.contact_heading ?? '¿Listo para empezar?');
const contactSubheadingHtml = mdToHtml(c.contact_subheading ?? 'Conversemos por WhatsApp para una respuesta más rápida o envíame un correo.');
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />

		<title>{title}</title>
		<meta name="description" content={description} />
		<meta name="author" content="Angel Argenis León Torres - A2LT Soluciones Integrales" />

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

		{gaId && (
			<>
				<script async src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}></script>
				<script is:inline>
					window.dataLayer = window.dataLayer || [];
					function gtag(){dataLayer.push(arguments);}
					gtag('js', new Date());
					gtag('config', gaId);
				</script>
			</>
		)}

  </head>
  <body class="text-text-base font-sans body-v7-1">
		<Header />
		<main class="w-full">
			<slot />
		</main>
		
    {/* Botón Flotante de WhatsApp */}
    {waHref ?
(
			<a href={waHref} target="_blank" rel="noopener noreferrer" class="floating-whatsapp" aria-label="Contactar por WhatsApp">
				<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="white"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.89-5.451 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01s-.521.074-.792.372c-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.289.173-1.413z"/></svg>
			</a>
		) : null}

    {/* Botón Flotante "Subir al Inicio" */}
    <a href="#inicio" id="scroll-to-top" class="floating-scroll-top" aria-label="Volver al inicio">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M12 2c-5.523 0-10 4.477-10 10s4.477 10 10 10 10-4.477 10-10-4.477-10-10-10zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8zm-1-8.414l-2.293 2.293-1.414-1.414 4.707-4.707 4.707 4.707-1.414 1.414-2.293-2.293v4.414h-2v-4.414z"/></svg>
    </a>

    {/* Tooltip de Email */}
    <div id="email-tooltip" class="fixed bottom-10 left-1/2 -translate-x-1/2 px-4 py-2 bg-green-600 text-white text-sm opacity-0 transition-opacity duration-300 pointer-events-none">
      ¡Dirección de correo copiada!
    </div>

    {/* --- INICIO: FOOTER (REDISEÑADO V8.0) --- */}
		<footer id="contacto" class="bg-primary py-16 px-8">
			<div class="container mx-auto max-w-screen-xl">
        
        {/* Bloque CTA (Sin cambios) */}
        {c.show_contact_section && (
          <div class="text-center max-w-4xl mx-auto mb-12 pb-12 border-b border-white/10">
            <h2 
              class="text-3xl md:text-4xl font-serif font-bold mb-4 text-white"
              set:html={contactHeadingHtml} 
            />
            <p 
              class="text-lg md:text-xl text-white/80 mb-8 max-w-2xl mx-auto"
              set:html={contactSubheadingHtml}
            />
          </div>
        )}

        {/* --- NUEVA REJILLA V8.0 --- */}
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
          
          {/* Columna 1: Logo, Descripción y Redes (4/12) */}
          <div class="lg:col-span-5 xl:col-span-4">
            {logo_footer ?
(
              <img src={logo_footer} alt={brand_name} class="w-48 mb-4" />
            ) : (
              <h2 class="text-2xl font-serif font-bold text-white mb-4">{brand_name}</h2>
            )}
            <p class="text-white/70 font-sans mb-6">
              {footerDescription ? footerDescription : "(Descripción de la empresa / Eslogan. Añadir a CMS si se desea)."}
            </p>
            {/* Iconos de Redes Sociales (V6.3) */}
            <div class="flex gap-4">
              {social.facebook && (
                <a href={social.facebook} target="_blank" rel="noopener" aria-label="Facebook" class="social-icon facebook-hover">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/></svg>
                </a>
              )}
              {social.instagram && (
                <a href={social.instagram} target="_blank" rel="noopener" aria-label="Instagram" class="social-icon instagram-hover">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.17.055 1.805.248 2.227.4.52.198.983.463 1.445.923.46.46.726.925.924 1.445.152.422.345 1.057.4 2.227.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.055 1.17-.248 1.805-.4 2.227-.198.52-.463.983-.923 1.445-.46.46-.925.726-1.445.924-.422.152-1.057.345-2.227.4-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.17-.055-1.805-.248-2.227-.4-.52-.198-.983.463-1.445-.923-.46-.46-.726.925-.924-1.445-.152.422-.345 1.057-.4-2.227-.058-1.266-.07-1.646-.07-4.85s.012-3.584.07-4.85c.055 1.17.248 1.805.4-2.227.198.52.463.983.923 1.445.46.46.925.726 1.445.924.422.152 1.057.345 2.227-.4C8.416 2.175 8.796 2.163 12 2.163m0-1.625C8.723.538 8.31.526 7.05.469 5.74.413 4.913.597 4.2.86c-.74.276-1.38.64-2.02 1.28C1.54 2.78.897 3.42.622 4.16c-.263.707-.448 1.533-.504 2.844C.06 8.31.048 8.723.048 12s.012 3.69.07 4.947c.055 1.31.24 2.137.504 2.844.275.74.638 1.38 1.28 2.02.64.64 1.28.998 2.02 1.278.707.263 1.533.448 2.844.504 1.31.058 1.723.07 4.947.07s3.69-.012 
 4.947-.07c1.31-.055 2.137-.24 2.844-.504.74-.275 1.38-.638 2.02-1.28.64-.64.998-1.28 1.278-2.02.263-.707.448-1.533.504-2.844.058-1.31.07-1.723.07-4.947s-.012-3.69-.07-4.947c-.055-1.31-.24-2.137-.504-2.844-.275-.74-.638 1.38-1.28-2.02C20.58.897 19.94.538 19.16.263c-.707-.263-1.533-.448-2.844-.504C15.01.06 14.597.048 12 .048zM12 6.18c-3.205 0-5.82 2.615-5.82 5.82s2.615 5.82 5.82 5.82 5.82-2.615 5.82-5.82-2.615-5.82-5.82-5.82zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm4.42-7.618c0 .62-.503 1.122-1.122 1.122s-1.122-.503-1.122-1.122.503-1.122 1.122-1.122 1.122.503 1.122 1.122z"/></svg>
                </a>
              )}
              {social.linkedin && (
                <a href={social.linkedin} target="_blank" 
 rel="noopener" aria-label="LinkedIn" class="social-icon linkedin-hover">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.783-1.75-1.75s.784-1.75 1.75-1.75 1.75.783 1.75 1.75-.783 1.75-1.75 1.75zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                </a>
              )}
              {social.twitter 
 && (
                <a href={social.twitter} target="_blank" rel="noopener" aria-label="X (formerly Twitter)" class="social-icon x-hover">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M18.901 1.153h3.68c-.083.562-.167 1.051-.278 1.584-.336 1.637-1.077 3.238-2.064 4.707-1.192 1.776-2.618 3.327-4.27 4.707-1.428 1.164-3.134 2.079-5.023 2.748-1.564.551-3.238.835-4.904.835-1.416 0-2.822-.246-4.148-.737-.89-.32-1.71-.72-2.48-1.196.223.013.435.025.669.025.86 0 1.666-.089 2.435-.259.982-.21 1.905-.562 2.754-1.078 1.428-.868 2.516-2.079 3.226-3.563-.589-.137-1.178-.291-1.752-.487-1.045-.35-2.023-.835-2.914-1.488-1.551-1.107-2.777-2.56-3.668-4.32-.422-.848-.737-1.74-.962-2.696.694.05 1.34.167 1.944.336.982.269 1.889.656 2.68 1.164 1.392.89 2.516 1.969 3.353 3.238.749 1.127 1.255 2.378 1.524 3.68.204.994.277 2.016.277 3.038v.178c0 .35-.013.694-.025 1.03-.025.101-.062.204-.089.303-.589 2.712-2.126 4.904-4.597 6.562-2.04.85-4.225 1.34-6.417 1.488-2.079-.114-4.114-.656-5.968-1.524 1.255.05 2.466.075 
 3.668.075 1.679 0 3.327-.19.499-.589 1.416-.397 2.668-.97.38-1.739 1.09-2.227 1.72-3.411 1.889-4.707 1.392-.994 2.516-2.31 3.29-3.92.512-1.038.823-2.164.935-3.327.126-1.315.152-2.628.089-3.928h-3.68z"/></svg>
                </a>
              )}
              {social.youtube && (
                <a href={social.youtube} target="_blank" rel="noopener" aria-label="YouTube" class="social-icon youtube-hover">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" 
 height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M21.583 7.142c-.23-.86-.902-1.532-1.762-1.762C18.254 5 12 5 12 5s-6.254 0-7.821.38c-.86.23-1.532.902-1.762 1.762C2 8.746 2 12 2 12s0 3.254.38 4.858c.23.86.902 1.532 1.762 1.762C5.746 19 12 19 12 19s6.254 0 7.821-.38c.86-.23 1.532.902 1.762-1.762C22 15.254 22 12 22 12s0-3.254-.38-4.858zM9.99 15.493V8.507L15.394 12l-5.404 3.493z"/></svg>
                </a>
              )}
            </div>
          </div>

          {/* Columna 2: Navegación y Contacto (7/12) */}
          <div class="lg:col-span-7 xl:col-span-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
              
              {/* Columnas de Navegación Dinámicas */}
              {navColumns.map(col => (
                <div>
                  <h3 class="font-serif font-bold text-lg text-white mb-4">
                    {col.title}
                  </h3>
                  <ul class="space-y-2">
                    {col.links.map(link => (
                      <li>
                        <a href={link.url} class="font-sans text-white/70 hover:text-accent transition-colors">
                          {link.text}
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              ))}

              {/* Columna de Contacto */}
              <div>
                <h3 class="font-serif font-bold text-lg text-white mb-4">
                  Contáctanos
                </h3>
                <div class="space-y-3 font-sans text-white/70">
                  {phone && (
                    <p>
                      <span class="font-bold text-white">Tel:</span> {phone}
                    </p>
                  )}
                  {c.address && (
                    <div class="prose prose-invert max-w-none text-white/70 prose-p:my-0">
                      <span class="font-bold text-white">Dir:</span>
                      <div set:html={renderedAddressHtml} />
                    </div>
                  )}
                </div>

                {/* BOTÓN WHATSAPP (Acentos V7.0) */}
                {waHref && (
                  <a 
                    href={waHref}
                    class="bg-accent text-text-inverted font-bold py-3 px-6 text-base inline-block mt-6 transition-transform duration-300 hover:scale-105 hover:no-underline"
                    target="_blank" rel="noopener noreferrer">
                    Contactar por WhatsApp
                  </a>
                )}

                {/* BOTÓN EMAIL SUTIL (Acentos V7.0) */}
                {email && (
                  <a 
                    id="email-copy-button"
                    href={`mailto:${email}`}
                    data-email={email}
                    class="bg-accent-secondary text-white font-bold py-2 px-4 text-sm inline-block mt-6 transition-all duration-300 ease-in-out hover:bg-white hover:text-primary border-2 border-accent-secondary hover:no-underline">
                    {email}
                  </a>
                )}
              </div>
            </div>
          </div>
         </div>

        {/* Barra de Copyright */}
        <div class="mt-16 border-t border-white/10 pt-8 flex flex-col md:flex-row justify-between items-center text-sm font-sans">
          <p class="text-white/60 text-center md:text-left">
            &copy;
 {new Date().getFullYear()} {brand_name}, Todos los derechos reservados.
          </p>
          <div>
            {/* GAP Identificado: Enlaces estáticos */}
            <a href="/legal/politicas-de-privacidad" class="text-white/60 hover:text-accent mt-4 md:mt-0">
              Políticas de Privacidad
            </a>
            &nbsp;|&nbsp;
 <a href="/legal/terminos-y-condiciones" class="text-white/60 hover:text-accent mt-4 md:mt-0">
              Términos y Condiciones
            </a>
          </div>
        </div>
			</div>
		</footer>
    {/* --- FIN: FOOTER --- */}

	</body>
</html>

<style is:global>
  html {
		scroll-behavior: smooth;
 }
	
  /* --- CAMBIO V7.1: Fondo Estático Futurista --- */
  .body-v7-1 {
    background-color: #0D0D1F;
 /* color 'primary' */
    /* Resplandor estático desde la esquina superior izquierda */
    background-image: radial-gradient(
      at 0% 0%, 
      rgba(0, 191, 255, 0.1), /* 'accent' con 10% opacidad */ 
      transparent 40%
    );
    background-attachment: fixed; /* Mantiene el gradiente fijo durante el scroll */
    background-repeat: no-repeat;
  }

  /* Estilos del Antiguo Body (ahora aplicados solo al Hero) */
	body {
		margin: 0;
  }
	.floating-whatsapp {
		position: fixed;
		bottom: 20px;
		right: 20px;
		background-color: #25D366;
		color: white;
		padding: 12px;
		border-radius: 50% !important;
		box-shadow: 0 4px 8px rgba(0,0,0,0.2);
		z-index: 1000;
		transition: transform 0.3s ease-in-out;
	}
	.floating-whatsapp:hover {
		transform: scale(1.1);
	}

  /* Botón Scroll to Top (MODIFICADO V7.0 para nueva paleta) */
  .floating-scroll-top {
    position: fixed;
    bottom: 20px;
    left: 20px; 
    transform: translateX(0); 
    background-color: #1A1A2E80; /* 'secondary' con 50% opacidad */
    backdrop-filter: blur(4px);
    color: white;
    padding: 10px;
    border-radius: 50% !important;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 999;
    transition: all 0.3s ease-in-out;
    opacity: 0;
    pointer-events: none;
  }
  .floating-scroll-top:hover {
		transform: translateX(0) scale(1.1);
    background-color: #1A1A2ECC;
 /* 'secondary' con 80% opacidad */
  }
  .floating-scroll-top.visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* Tooltip de Email */
  #email-tooltip.visible {
    opacity: 1;
  }

  /* ===== INICIO: ESTILOS SOCIAL ICONS (V6.4) ===== */
  .social-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px; /* Tamaño del círculo */
    height: 40px;
 /* Tamaño del círculo */
    border-radius: 50%;
 /* Hacerlo circular */
    background-color: rgba(0, 191, 255, 0.1);
 /* 'accent' con 10% opacidad */
    color: #FFFFFF;
 /* Color del icono por defecto (Blanco) */
    transition: all 0.3s ease-in-out;
 /* Transición suave */
    flex-shrink: 0; 
  }

  .social-icon svg {
    width: 20px;
 /* Tamaño del SVG dentro del círculo */
    height: 20px;
    fill: currentColor;
 /* Asegura que el SVG herede el color */
  }

  .social-icon:hover {
    transform: translateY(-3px) scale(1.05);
 /* Pequeño efecto de elevación y zoom */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
 /* Sombra para profundidad */
  }

  /* Colores y efecto Hover para cada red social */
  .facebook-hover:hover {
    background-color: #1877F2;
 /* Facebook Blue */
    color: white; /* Icono blanco */
  }

  .instagram-hover:hover {
    background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
    color: white;
  }

  .x-hover:hover {
    background-color: #000000; /* X Black */
    color: white;
 /* Icono blanco */
  }

  .linkedin-hover:hover {
    background-color: #0A66C2;
 /* LinkedIn Blue */
    color: white; /* Icono blanco */
  }

  .youtube-hover:hover {
    background-color: #FF0000;
 /* YouTube Red */
    color: white; /* Icono blanco */
  }
  /* ===== FIN: ESTILOS SOCIAL ICONS ===== */
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    
    // --- Lógica de Scroll-to-Top ---
    const scrollTopButton = document.getElementById('scroll-to-top');
    if (scrollTopButton) {
      window.addEventListener('scroll', () => {
        if (window.scrollY > window.innerHeight) {
          scrollTopButton.classList.add('visible');
        } else {
           scrollTopButton.classList.remove('visible');
        }
      });
    }

    // --- Lógica de Copiar Correo (V6.1) ---
    const emailButton = document.getElementById('email-copy-button');
    const tooltip = document.getElementById('email-tooltip');
    if (emailButton && tooltip) {
      emailButton.addEventListener('click', (e) => {
        e.preventDefault(); 
        const email = emailButton.getAttribute('data-email');
        if (email) {
           navigator.clipboard.writeText(email)
            .then(() => {
              tooltip.classList.add('visible');
              setTimeout(() => {
                tooltip.classList.remove('visible');
              }, 2000);
            })
            .catch(err => {
              console.error('Fallo al copiar el correo: ', err);
              window.location.href = `mailto:${email}`;
            });
        }
      });
    }
  });
</script>