---
// @src/components/FeaturedProject.astro (VERSIÓN 7.1 - CTA Dinámico)
import type { CollectionEntry } from 'astro:content';
import { mdToHtml } from '../utils/markdown';
import { getEntry } from 'astro:content'; // NUEVO

export interface Props {
  project: CollectionEntry<'proyectos'>;
}
const { project } = Astro.props;

// NUEVO: Cargar textos de CTA
const ajustes = await getEntry("ajustes", "home");
const ctaTextos = ajustes?.data.cta_textos ?? {};
const ctaText = ctaTextos.leer_mas ?? "Leer Más";

// Datos del proyecto
const clientName = project.data.client_name;
const titulo = project.data.titulo;
const summary = project.data.summary;
const image = project.data.image ?? '/assets/uploads/placeholder.jpeg';

// Renderizar HTML si hay resumen
const summaryHtml = summary ? mdToHtml(summary) : null;
---

<article class="
  grid grid-cols-1 lg:grid-cols-2 gap-0 w-full 
  rounded-lg overflow-hidden 
  bg-secondary/70 backdrop-blur-md
  border border-white/10
">
  
  <div class="relative min-h-[300px] lg:min-h-0">
    <img 
      src={image} 
      alt={`Imagen del proyecto ${titulo}`} 
      class="absolute inset-0 w-full h-full object-cover" 
    />
  </div>

  <div class="flex flex-col justify-center p-8 md:p-12 lg:p-16">
    
    <span class="font-sans text-sm font-bold text-accent-secondary uppercase tracking-wider mb-2">
      {clientName}
    </span>
   
    <h2 class="font-serif text-3xl md:text-4xl font-bold text-white mb-4 leading-tight">
      {titulo}
    </h2>
    
    {summaryHtml && (
      <div class="prose max-w-none text-text-base/80 mb-6">
        <span set:html={summaryHtml} />
      </div>
    )}
    
    <div class="mt-auto">
      <a 
        href={`/proyectos/${project.slug}`} 
        class="
          bg-accent text-text-inverted font-bold 
          py-3 px-6 text-base 
          transition-colors duration-300 
          hover:bg-accent-secondary inline-block hover:no-underline
        "
      >
        {/* CORREGIDO (Req #2): Texto de CTA dinámico */}
        {ctaText}
      </a>
    </div>
  </div>

</article>