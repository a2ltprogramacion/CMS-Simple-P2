---
// @src/components/ProductCard.astro (VERSIÓN 7.2 - Corrección Sintaxis Interface)
import type { CollectionEntry } from 'astro:content';
import { mdToHtml } from '../utils/markdown';
import { getEntry } from 'astro:content'; 

// CORRECCIÓN V8.2: 'interface Props' es la sintaxis correcta
export interface Props {
  producto: CollectionEntry<'productos'>; // Colección renombrada
}
const { producto } = Astro.props;

// Cargar textos de CTA
const ajustes = await getEntry("ajustes", "home");
const ctaTextos = ajustes?.data.cta_textos ?? {};
const contactText = ctaTextos.contactar_producto ?? "Contactar para este producto";

// Cargar datos de la colección (con fallbacks)
const renderedTitle = producto.data.title ?? "Producto de Ejemplo";
const subtitle = producto.data.subtitle;
const description = producto.data.description;
const image = producto.data.image ?? '/assets/uploads/placeholder.jpeg';

// Renderizar Markdown
const renderedDescriptionHtml = mdToHtml(description ?? "");
---

<div class="
  group relative flex flex-col h-96 w-full 
  rounded-lg overflow-hidden cursor-pointer
  bg-secondary/70 backdrop-blur-md 
  border border-white/10
  transition-all duration-300
  hover:border-accent hover:shadow-2xl hover:shadow-accent/10
">
  <img 
    src={image} 
    alt={renderedTitle} 
    class="w-full h-40 object-cover"
  />
  
  <div class="flex flex-col flex-grow p-6">
    <h3 class="text-2xl font-serif font-bold mb-2 text-white">
        {renderedTitle}
    </h3>
    
    {subtitle && (
      <p class="text-sm text-text-base/70 mb-2">
        {subtitle}
      </p>
    )}
    
    {description && (
      <div class="prose max-w-none text-text-base/80 prose-strong:text-accent text-sm">
        <span set:html={renderedDescriptionHtml} />
      </div>
    )}

    <p class="mt-auto pt-4 text-sm text-accent hover:text-white font-bold">
      <a href="#contacto" class="hover:underline">{contactText}</a>
    </p>
  </div>
</div>