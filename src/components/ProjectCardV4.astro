---
// @src/components/ProjectCardV4.astro (VERSIÓN 7.1 - CTA Dinámico)
// Esta es la tarjeta "pequeña" para la rejilla de "Lo Último"
import type { CollectionEntry } from 'astro:content';
import { mdToHtml } from '../utils/markdown';
import { getEntry } from 'astro:content'; // NUEVO

export interface Props {
  project: CollectionEntry<'proyectos'>;
}
const { project } = Astro.props;

// NUEVO: Cargar textos de CTA
const ajustes = await getEntry("ajustes", "home");
const ctaTextos = ajustes?.data.cta_textos ?? {};
const ctaText = ctaTextos.ver_proyecto ?? "Ver Caso de Estudio &rarr;";

// Cargar datos (del schema de Proyectos)
const clientName = project.data.client_name;
const titulo = project.data.titulo;
const summary = project.data.summary;
const image = project.data.image ?? '/assets/uploads/placeholder.jpeg';

const renderedSummaryHtml = mdToHtml(summary ?? "");
---

<a 
  href={`/proyectos/${project.slug}`} 
  class="
    group relative flex flex-col h-96 w-full 
    rounded-lg overflow-hidden cursor-pointer
    bg-secondary/70 backdrop-blur-md 
    border border-white/10
    transition-all duration-300
    hover:border-accent-secondary hover:shadow-2xl hover:shadow-accent-secondary/10
    no-underline hover:no-underline
">
  <img 
    src={image} 
    alt={titulo} 
    class="w-full h-40 object-cover"
  />
  
  <div class="flex flex-col flex-grow p-6">
    <span class="font-sans text-xs font-bold text-accent-secondary uppercase tracking-wider mb-2">
      {clientName}
    </span>
 
    <h3 class="text-xl font-serif font-bold mb-2 text-white">
        {titulo}
    </h3>
    
    {summary && (
      <div class="prose max-w-none text-text-base/80 prose-strong:text-accent text-sm">
        <span set:html={renderedSummaryHtml} />
      </div>
    )}

    <p class="mt-auto pt-4 text-sm text-accent-secondary hover:text-white font-bold group-hover:underline">
      {/* CORREGIDO (Req #2): Texto de CTA dinámico */}
      {ctaText}
    </p>
  </div>
</a>